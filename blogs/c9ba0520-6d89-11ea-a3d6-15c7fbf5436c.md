[1 ThreeJS库介绍](#1)


[2 大致流程](#2)


[3 ThreeJS基础渲染](#3)


&emsp;[3.1 场景对象](#3-1)  


&emsp;[3.2 相机](#3-2)  


&emsp;[3.3 光源](#3-3)  


&emsp;[3.4 模型](#3-4)  


[4 总结](#4)


articleLine

## <span id="1" class="title">1 ThreeJS库介绍</span>
&emsp;&emsp;Three.js是基于原生WebGL封装运行的三维引擎，在所有WebGL引擎中，Three.js是国内文资料最多、使用最广泛的三维引擎。大量运用于网页3D渲染中，可以用于制作三维网页游戏，物联网可视化，数据可视化等领域。但是目前国内的火热度还不是很高，所以使用过程有些奇奇怪怪的bug经常搜不到，入门教程可以看->[教程](http://www.yanhuangxueyuan.com/)  
&emsp;&emsp;这次学习ThreeJS主要是想做一个室内装修预览的系统，其中部分效果如下：（图片来自于小红书）
![渲染图](https://img-blog.csdnimg.cn/20200324115824744.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lqbHRvcA==,size_16,color_FFFFFF,t_70#pic_center)  
这是一个效果渲染图，通常是由装修公司展示给房主的，但是通常是需要专业的软件才可以进行操作，一般房主是只能看到效果图的。我想做的是增加第一人称漫游的效果，让视觉进入房间内，并可以对家居进行可以化操作。如果有可能，后期还会增设智能家居的交互。

## <span id="2" class="title">2 大致流程</span>
1. 房型图绘制  
&ensp;1.1 点-线-面-体的绘制  
&ensp;1.2 点-线-面-体的删除  
&ensp;1.3 距离/角度/体积测量    
&ensp;1.4 优化绘制方式  
2. 室内预览制作  
&ensp;2.1 第一人称操作器  
&ensp;2.2 模型的动态加载与移除  
&ensp;2.3 模型吸附  
&ensp;2.4 模型移动  
&ensp;2.5 优化灯光效果  
3. 联网交互  
&ensp;3.1 场景的导出与加载  
&ensp;3.2 用户系统  

## <span id="3" class="title">3 ThreeJS基础渲染</span>
ThreeJS核心包括4大对象：
1. 场景
2. 相机
3. 灯光
4. 模型

### <span id="3.1" class="title">3.1 场景对象</span>
```js
// 初始化场景
var scene = new THREE.Scene()
// 添加内容到场景中
scene.add()//相机，灯光，模型
```

### <span id="3.2" class="title">3.2 相机</span>
&emsp;&emsp;相机通常有两种，一种是正投影相机，一种是透视相机，前者视觉不受距离影响，后者视觉受距离影响。在绘制房型图时我用正投影相机，室内预览时用透视相机。

```js
// 正投影相机
var camera = new THREE.OrthographicCamera( left, right, top, bottom, near, far )
/*
  left : 左边界
  right ：右边界
  top ：上边界
  bottom ： 下边界
  near ：距离多远开始渲染（一般很小）
  far ：表示距离多远结束渲染（太小看不到）
*/

// 透视相机
var camera = new THREE.PerspectiveCamera( fov, aspect, near, far )
/*
  fov : 能看到的角度范围，游戏一般60-90
  aspect : 渲染窗口比例
  near ：多远开始渲染
  far ：结束渲染位置
*/

// 部分方法
camera.updateProjectionMatrix () //更新相机数据
//相机位置设置
camera.position.x
camera.position.y
camera.position.z
camera.lookAt()//相机朝向，注意使用OrbitControls控制器时会无效，因为它内置了初始化朝向。
```

### <span id="3.3" class="title">3.3 光源</span>
&emsp;&emsp;ThreeJS有三种光源和环境光，项目主要用到3种，环境光，平行光和点光源。平行光用于模仿太阳光线，点光源用于模仿室内灯光。

```js
// 环境光
new THREE.AmbientLight(color)
// 点光源
new THREE,PointLight(color,intensity)
// 平行光，需要设置朝向，不设置默认为（0,0,0）
new THREE,DirectionalLight(color,intensity)

// 部分方法
.position.set()
.target//朝向

// 光线辅助
PointLightHelper
DirectionalLightHelper
```

### <span id="3.4" class="title">3.4 模型</span>
模型有多种，项目中主要用到3种：  
1. 外部导入模型，用于室内的各种装饰  
2. 点-线-面的绘制  
3. 根据面拉伸成体对象  

## <span id="4" class="title">4 总结</span>
&emsp;&emsp;上面介绍的只是ThreeJS的渲染基础，教程内容可以参考[教程](http://www.yanhuangxueyuan.com/)。预计这个项目需要半年时间，如果包括部署上线可能更久。以后会不定时更新进度，并分享一些思路及坑。
